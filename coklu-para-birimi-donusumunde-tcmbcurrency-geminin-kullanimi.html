<!DOCTYPE html>
<html class='no-js' lang='en'>
<head>
<meta charset='utf-8'>
<meta content='IE=edge,chrome=1' http-equiv='X-UA-Compatible'>
<title>lab2023 | web & mobile development, graphic design company - Çoklu Para Birimi Dönüşümünde TcmbCurrency Geminin Kullanımı
</title>
<meta content='Designers and developers for hire' name='description'>
<meta content='design, ruby, ruby on rails, ios, android, sencha, istanbul, ankara, denizli, turkey' name='keywords'>
<link href="assets/stylesheets/application.css" rel="stylesheet" /><link href="//maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css" rel="stylesheet" /><link href="assets/stylesheets/swiper-bundle.min.css" rel="stylesheet" />
<link href="assets/images/favicon.png" rel="icon" type="image/png" />
<meta content='Çoklu Para Birimi Dönüşümünde TcmbCurrency Geminin Kullanımı' name='description'>
<meta content='currency, tr' name='keywords'>
<meta content='Hamit Türkü KAYA' name='author'>


</head>
<body id='blog'>
<header class='header'>
<div class='container'>
<div class='row'>
<div class='col-lg-2 col-lg-offset-1'>
<a href="/blog"><img class="logo pull-right" width="252" height="253" src="assets/images/logo.png" alt="Logo" />
</a></div>
<div class='col-lg-8'>
<h1>
<a href="/blog">lab2023's blog posts</a>
<a href="http://lab2023.com/feed.xml" target="_blank"><i class='fa fa-rss'></i>
</a></h1>
<div class='row'>
<div class='col-lg-3'>
<p>
<a href="/"><i class='fa fa-arrow-circle-left'></i>
lab2023.com
</a></p>
</div>
<div class='col-lg-9' id='language_linked'>
<p>
<a href="/tag/tr.html">Türkçe
</a>·
<a href="/tag/en.html">English
</a>·
<a href="/tag/es.html">Español
</a>·
<a href="/tag/ru.html">Русский
</a></p>
</div>
</div>
</div>
</div>
</div>
</header>

<!-- share-buttons js code -->
<div id='fb-root'>
<script>
  (function(d, s, id) {
    var js, fjs = d.getElementsByTagName(s)[0];
    if (d.getElementById(id)) return;
    js = d.createElement(s); js.id = id;
    js.src = "//connect.facebook.net/tr_TR/all.js#xfbml=1";
    fjs.parentNode.insertBefore(js, fjs);
  }(document, 'script', 'facebook-jssdk'));
  (function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs'));
</script>
</div>
<div class='container'>
<div class='row'>
<div class='col-lg-2 col-lg-offset-1 article-meta'>
<h4><a href="http://twitter.com/hamitturkukaya" target="_blank">Hamit Türkü KAYA</a></h4>
<h5>July 30, 2013</h5>
<span class='tag'><a href="/tag/currency.html">currency</a></span>
<span class='tag'><a href="/tag/tr.html"> tr</a></span>
<!-- Share buttons -->
<ul class='share_button'>
<li>
<div class='fb-share-button' data-href='http://lab2023.com/coklu-para-birimi-donusumunde-tcmbcurrency-geminin-kullanimi.html' data-type='button_count'></div>
</li>
<li>
<a class='twitter-share-button' data-text='http://lab2023.com/coklu-para-birimi-donusumunde-tcmbcurrency-geminin-kullanimi.html' data-via='lab2023' href='https://twitter.com/share'></a>
</li>
<li>
<script src='//platform.linkedin.com/in.js' type='text/javascript'>
<![CDATA[
    lang: en_US
]]>
</script>
<script data-url='http://lab2023.com/coklu-para-birimi-donusumunde-tcmbcurrency-geminin-kullanimi.html' type='IN/Share'></script>
</li>
</ul>
</div>
<div class='col-lg-8'>
<article class='post'>
<h1>Çoklu Para Birimi Dönüşümünde TcmbCurrency Geminin Kullanımı</h1>
<p>Rails&#39;da Çoklu para birimi dönüşümü (Multi Currency) için geliştirilmiş olan <a href="https://github.com/RubyMoney/money">money gem</a> 
ve <a href="https://github.com/RubyMoney/money-rails">money-rails gem</a>&rsquo;i ni kullanırken geçmişe yönelik dönüşüm yapma sıkıntısı 
ve oranları <strong>Türkiye Cumhuriyeti Merkez Bankası</strong>&lsquo;ndan kur almak amacıyla 
<a href="https://github.com/RubyMoney/google_currency">google-currency gem</a>&rsquo;ini uyarlanmıştır. Bu gem ile Merkez Bankası&#39;ndaki 
20&#39;ye yakın para birimi ile dönüşümü <a href="https://github.com/RubyMoney/money">Money</a> gemi altyapısıyla kullanabilirsiniz.</p>

<p>Öncelikle gemfile&#39;ımıza <strong>money-rails</strong> ve <strong>tcmb_currency</strong> gemlerini ekliyoruz</p>
<div class="highlight"><pre class="highlight ruby"><code><span class="n">gem</span> <span class="s1">'money-rails'</span>
<span class="n">gem</span> <span class="s1">'tcmb_currency'</span><span class="p">,</span> <span class="ss">:git</span> <span class="o">=&gt;</span> <span class="err">'</span><span class="n">git</span><span class="ss">:/</span><span class="o">/</span><span class="n">github</span><span class="p">.</span><span class="nf">com</span><span class="o">/</span><span class="n">lab2023</span><span class="o">/</span><span class="n">tcmb_currency</span><span class="p">.</span><span class="nf">git</span>
</code></pre></div>
<p>ve ardından <em>bundle install</em> komutunu çalıştırarak gemleri projeye dahil ediyoruz. Gemler yüklenip, projeye dahil edildikten sonra terminalden</p>
<div class="highlight"><pre class="highlight shell"><code><span class="nv">$ </span>rails g tcmb_currency:initializer
<span class="nv">$ </span>rails g tcmb_currency:migration
<span class="nv">$ </span>rake db:migrate
</code></pre></div>
<p>komutlarını çalıştırıp initializer dosyasını ve database tablolarını oluşturuyoruz. &lt;!&ndash; more &ndash;&gt; Son olarak ise</p>
<div class="highlight"><pre class="highlight shell"><code><span class="nv">$ </span>rake tcmb_currency:insert_from_tcmb
</code></pre></div>
<p>rake task&#39;ını günlük olarak çalışacak bir cron job a atayarak (bu iş için <a href="https://github.com/javan/whenever">whenever gem</a> 
kullanılabilir), günlük olarak oranların database&#39;e eklenmesi sağlanır</p>

<p>Ardından tek yapılması gereken money gemi işlemleri cent,kuruş vb. bazlı yaptığı için modelinize <em>monetize :price_cents</em> 
eklemek.</p>
<div class="highlight"><pre class="highlight plaintext"><code>class Product &lt; ActiveRecord::Base
    attr_accessible :price, :product ,:price_cents, :price_currency
    monetize :price_cents
end
</code></pre></div>
<p>Artık view katmanında</p>
<div class="highlight"><pre class="highlight ruby"><code><span class="o">&lt;</span><span class="sx">% @products.each </span><span class="k">do</span> <span class="o">|</span><span class="n">product</span><span class="o">|</span> <span class="sx">%&gt;
    &lt;tr&gt;</span>
        <span class="o">&lt;</span><span class="n">td</span><span class="o">&gt;&lt;</span><span class="sx">%= product.product %&gt;&lt;/td&gt;
        &lt;td&gt;&lt;% price =</span><span class="no">Money</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="n">product</span><span class="p">.</span><span class="nf">price_cents</span><span class="p">,</span><span class="n">product</span><span class="p">.</span><span class="nf">price_currency</span><span class="p">)</span> <span class="o">%&gt;&lt;</span><span class="sr">/td&gt;
        &lt;td&gt;&lt;%= humanized_money_with_symbol price %&gt;&lt;/</span><span class="n">td</span><span class="o">&gt;</span>
        <span class="o">&lt;</span><span class="n">td</span><span class="o">&gt;&lt;</span><span class="sx">%= humanized_money_with_symbol price.exchange_to(:JPY) %&gt;&lt;/td&gt;
        &lt;td&gt;&lt;%=</span> <span class="n">humanized_money_with_symbol</span> <span class="n">price</span><span class="p">.</span><span class="nf">exchange_to</span><span class="p">(</span><span class="ss">:EUR</span><span class="p">,</span> <span class="s2">"2013-03-06"</span><span class="p">)</span> <span class="o">%&gt;&lt;</span><span class="sr">/td&gt;
        &lt;td&gt;&lt;%= link_to 'Show', product %&gt;&lt;/</span><span class="n">td</span><span class="o">&gt;</span>
        <span class="o">&lt;</span><span class="n">td</span><span class="o">&gt;&lt;</span><span class="sx">%= link_to 'Edit', edit_product_path(product) %&gt;&lt;/td&gt;
        &lt;td&gt;&lt;%=</span> <span class="n">link_to</span> <span class="s1">'Destroy'</span><span class="p">,</span> <span class="n">product</span><span class="p">,</span> <span class="ss">method: :delete</span><span class="p">,</span> <span class="ss">data: </span><span class="p">{</span> <span class="ss">confirm: </span><span class="s1">'Are you sure?'</span> <span class="p">}</span> <span class="o">%&gt;&lt;</span><span class="sr">/td&gt;
    &lt;/</span><span class="n">tr</span><span class="o">&gt;</span>
<span class="o">&lt;</span><span class="sx">% end </span><span class="o">%&gt;</span>
</code></pre></div>
<p>şeklinde kullanabilirsiniz</p>
<div class="highlight"><pre class="highlight ruby"><code><span class="c1"># O güne ait oranlara göre dönüşüm yapar</span>
<span class="no">Money</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="mi">1000</span><span class="p">,</span><span class="s2">"USD"</span><span class="p">).</span><span class="nf">exchange_to</span><span class="p">(</span><span class="ss">:EUR</span><span class="p">)</span> 
<span class="c1"># Verilen tarihe ait oranlara göre dönüşüm yapar</span>
<span class="no">Money</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="mi">1000</span><span class="p">,</span><span class="s2">"USD"</span><span class="p">).</span><span class="nf">exchange_to</span><span class="p">(</span><span class="ss">:EUR</span><span class="p">,</span> <span class="s2">"2013-03-02"</span><span class="p">)</span> 
</code></pre></div>
<div id='disqus_thread'></div>
<script>
  var disqus_shortname = 'lab2023';
  (function() {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
</script>
<noscript>
Please enable JavaScript to view the
<a href='http://disqus.com/?ref_noscript'>comments powered by Disqus.</a>
</noscript>
<a class='dsq-brlink' href='http://disqus.com'>
comments powered by
<span class='logo-disqus'>Disqus</span>
</a>
</article>
</div>
</div>
</div>
<footer class='footer'>
<h4>© 2009 ~ 2023 LAB2023, CORP.</h4>
<p>The all designs, materials and contents trademarks of lab2023, corp.</p>
</footer>

</body>
<!-- Javascripts -->

<script src="//ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script><script src="//cdnjs.cloudflare.com/ajax/libs/modernizr/2.7.1/modernizr.min.js"></script><script src="assets/javascripts/vendor/swiper-bundle.min.js"></script><script src="assets/javascripts/application.js"></script>
<script>
  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-12243799-3']);
  _gaq.push(['_trackPageview']);
  
  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();
</script>


</html>
