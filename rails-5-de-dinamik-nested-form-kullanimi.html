<!DOCTYPE html>
<html class='no-js' lang='en'>
<head>
<meta charset='utf-8'>
<meta content='IE=edge,chrome=1' http-equiv='X-UA-Compatible'>
<title>lab2023 | web & mobile development, graphic design company - Rails 5'de Dinamik Nested Form Kullanımı
</title>
<meta content='Designers and developers for hire' name='description'>
<meta content='design, ruby, ruby on rails, ios, android, sencha, istanbul, ankara, denizli, turkey' name='keywords'>
<link href="assets/stylesheets/application.css" rel="stylesheet" /><link href="//maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css" rel="stylesheet" /><link href="assets/stylesheets/swiper-bundle.min.css" rel="stylesheet" />
<link href="assets/images/favicon.png" rel="icon" type="image/png" />
<meta content='Rails 5&#39;de Dinamik Nested Form Kullanımı' name='description'>
<meta content='ruby, dynamic, nested, form, rails, tr' name='keywords'>
<meta content='Hamdi BAYHAN' name='author'>


</head>
<body id='blog'>
<header class='header'>
<div class='container'>
<div class='row'>
<div class='col-lg-2 col-lg-offset-1'>
<a href="/blog"><img class="logo pull-right" width="252" height="253" src="assets/images/logo.png" alt="Logo" />
</a></div>
<div class='col-lg-8'>
<h1>
<a href="/blog">lab2023's blog posts</a>
<a href="http://lab2023.com/feed.xml" target="_blank"><i class='fa fa-rss'></i>
</a></h1>
<div class='row'>
<div class='col-lg-3'>
<p>
<a href="/"><i class='fa fa-arrow-circle-left'></i>
lab2023.com
</a></p>
</div>
<div class='col-lg-9' id='language_linked'>
<p>
<a href="/tag/tr.html">Türkçe
</a>·
<a href="/tag/en.html">English
</a>·
<a href="/tag/es.html">Español
</a>·
<a href="/tag/ru.html">Русский
</a></p>
</div>
</div>
</div>
</div>
</div>
</header>

<!-- share-buttons js code -->
<div id='fb-root'>
<script>
  (function(d, s, id) {
    var js, fjs = d.getElementsByTagName(s)[0];
    if (d.getElementById(id)) return;
    js = d.createElement(s); js.id = id;
    js.src = "//connect.facebook.net/tr_TR/all.js#xfbml=1";
    fjs.parentNode.insertBefore(js, fjs);
  }(document, 'script', 'facebook-jssdk'));
  (function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs'));
</script>
</div>
<div class='container'>
<div class='row'>
<div class='col-lg-2 col-lg-offset-1 article-meta'>
<h4><a href="http://twitter.com/h_1520" target="_blank">Hamdi BAYHAN</a></h4>
<h5>February 10, 2017</h5>
<span class='tag'><a href="/tag/ruby.html">ruby</a></span>
<span class='tag'><a href="/tag/dynamic.html"> dynamic</a></span>
<span class='tag'><a href="/tag/nested.html"> nested</a></span>
<span class='tag'><a href="/tag/form.html"> form</a></span>
<span class='tag'><a href="/tag/rails.html"> rails</a></span>
<span class='tag'><a href="/tag/tr.html"> tr</a></span>
<!-- Share buttons -->
<ul class='share_button'>
<li>
<div class='fb-share-button' data-href='http://lab2023.com/rails-5-de-dinamik-nested-form-kullanimi.html' data-type='button_count'></div>
</li>
<li>
<a class='twitter-share-button' data-text='http://lab2023.com/rails-5-de-dinamik-nested-form-kullanimi.html' data-via='lab2023' href='https://twitter.com/share'></a>
</li>
<li>
<script src='//platform.linkedin.com/in.js' type='text/javascript'>
<![CDATA[
    lang: en_US
]]>
</script>
<script data-url='http://lab2023.com/rails-5-de-dinamik-nested-form-kullanimi.html' type='IN/Share'></script>
</li>
</ul>
</div>
<div class='col-lg-8'>
<article class='post'>
<h1>Rails 5'de Dinamik Nested Form Kullanımı</h1>
<p>Merhabalar,</p>

<p>Bu yazıda sizelere Rails&#39;de dinamik nested form kullanımını bir örnek ile göstereceğim. Eğer birbiri ile ilişkili iki 
modeliniz var ise ve tek bir form üzerinden kayıt yapacaksanız nested form kullanmanız gerekiyor.
Şimdi öncelikle aşağıdaki gibi birbiri ile ilişkili iki modelinizin olduğu bir rails projeniz olduğunu varsayalım. 
İlişki şekli şu şekilde olsun Customer(Müşteri) ve Customer&#39;ın AuthorizedPerson(YetkiliKişi)&lsquo;ları.</p>

<p>Aşağıda <code>accepts_nested_attributes_for</code>ile nested attribute ilişkiyi kuruyoruz;</p>
<div class="highlight"><pre class="highlight ruby"><code><span class="c1"># app/models/customer.rb</span>
<span class="n">has_many</span> <span class="ss">:authorized_persons</span><span class="p">,</span> <span class="ss">dependent: :destroy</span>
<span class="n">accepts_nested_attributes_for</span> <span class="ss">:authorized_persons</span><span class="p">,</span> <span class="ss">allow_destroy: </span><span class="kp">true</span>

<span class="c1"># app/models/authorized_person.rb</span>
<span class="n">belongs_to</span> <span class="ss">:customer</span><span class="p">,</span> <span class="ss">optional: </span><span class="kp">true</span>
</code></pre></div>
<p>Strong parametrelerimizi aşağıdaki gibi ayarlıyoruz. Burada <code>authorized_persons_attributes</code> ile AuthorizedPerson için gelen verilerin geçmesine izin veriyoruz.</p>
<div class="highlight"><pre class="highlight ruby"><code><span class="c1">#app/controllers/customers_controller.rb</span>
<span class="k">def</span> <span class="nf">customer_params</span>
    <span class="n">params</span><span class="p">.</span><span class="nf">require</span><span class="p">(</span><span class="ss">:customer</span><span class="p">).</span><span class="nf">permit</span><span class="p">(</span><span class="ss">:name</span><span class="p">,</span> <span class="ss">authorized_persons_attributes: </span><span class="p">[</span><span class="ss">:id</span><span class="p">,</span> <span class="ss">:email</span><span class="p">,</span> <span class="ss">:_destroy</span><span class="p">])</span>
<span class="k">end</span>
</code></pre></div>
<p>formumuzu aşağıdaki gibi oluşturuyoruz, aşağıdaki <code>fields_for</code> kısmı nested formda ilgili diğer modelimizin alanlarını eklemek için gerekli alandır. </p>
<div class="highlight"><pre class="highlight ruby"><code><span class="o">=</span> <span class="n">simple_form_for</span><span class="p">(</span><span class="vi">@customer</span><span class="p">,</span> <span class="ss">validate: </span><span class="kp">true</span><span class="p">)</span> <span class="k">do</span> <span class="o">|</span><span class="n">f</span><span class="o">|</span>
  <span class="p">.</span><span class="nf">form</span><span class="o">-</span><span class="n">inputs</span>
    <span class="o">=</span> <span class="n">f</span><span class="p">.</span><span class="nf">input</span> <span class="ss">:name</span>
    <span class="o">=</span> <span class="n">link_to_add_fields</span> <span class="s1">'Add Authorized People'</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="ss">:authorized_persons</span>
        <span class="o">=</span> <span class="n">f</span><span class="p">.</span><span class="nf">fields_for</span> <span class="ss">:authorized_persons</span> <span class="k">do</span> <span class="o">|</span><span class="n">builder</span><span class="o">|</span>
          <span class="o">=</span> <span class="n">render</span> <span class="s1">'authorized_person_fields'</span><span class="p">,</span> <span class="ss">f: </span><span class="n">builder</span>

  <span class="p">.</span><span class="nf">form</span><span class="o">-</span><span class="n">actions</span>
    <span class="o">=</span> <span class="n">f</span><span class="p">.</span><span class="nf">button</span> <span class="ss">:submit</span>
</code></pre></div>
<p>Helper dosyamıza aşağıdaki kodları koyuyoruz:</p>
<div class="highlight"><pre class="highlight ruby"><code><span class="c1">#app/helpers/application_helper.rb</span>
<span class="k">def</span> <span class="nf">link_to_add_fields</span><span class="p">(</span><span class="nb">name</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">association</span><span class="p">)</span>
    <span class="n">new_object</span> <span class="o">=</span> <span class="n">f</span><span class="p">.</span><span class="nf">object</span><span class="p">.</span><span class="nf">send</span><span class="p">(</span><span class="n">association</span><span class="p">).</span><span class="nf">klass</span><span class="p">.</span><span class="nf">new</span>
    <span class="nb">id</span> <span class="o">=</span> <span class="n">new_object</span><span class="p">.</span><span class="nf">object_id</span>
    <span class="n">fields</span> <span class="o">=</span> <span class="n">f</span><span class="p">.</span><span class="nf">fields_for</span><span class="p">(</span><span class="n">association</span><span class="p">,</span> <span class="n">new_object</span><span class="p">,</span> <span class="ss">child_index: </span><span class="nb">id</span><span class="p">)</span> <span class="k">do</span> <span class="o">|</span><span class="n">builder</span><span class="o">|</span>
      <span class="n">render</span><span class="p">(</span><span class="n">association</span><span class="p">.</span><span class="nf">to_s</span><span class="p">.</span><span class="nf">singularize</span> <span class="o">+</span> <span class="s1">'_fields'</span><span class="p">,</span> <span class="ss">f: </span><span class="n">builder</span><span class="p">)</span>
    <span class="k">end</span>
    <span class="n">link_to</span><span class="p">(</span><span class="nb">name</span><span class="p">,</span> <span class="s1">'#'</span><span class="p">,</span> <span class="ss">class: </span><span class="s1">'add_fields'</span><span class="p">,</span> <span class="ss">data: </span><span class="p">{</span><span class="ss">id: </span><span class="nb">id</span><span class="p">,</span> <span class="ss">fields: </span><span class="n">fields</span><span class="p">.</span><span class="nf">gsub</span><span class="p">(</span><span class="s1">'\n'</span><span class="p">,</span> <span class="s1">''</span><span class="p">)})</span>
<span class="k">end</span>
</code></pre></div>
<p><code>_authorized_person_fields</code> dosyamız aşağıdaki gibidir.</p>
<div class="highlight"><pre class="highlight ruby"><code><span class="c1">#app/views/customers/_authorized_person_fields.html.haml</span>
<span class="o">%</span><span class="n">fieldset</span>
    <span class="o">=</span> <span class="n">link_to</span> <span class="s1">'Remove Authorized People'</span><span class="p">,</span> <span class="s1">'#'</span><span class="p">,</span> <span class="ss">class: </span><span class="s1">'remove_fields'</span>
    <span class="o">=</span> <span class="n">f</span><span class="p">.</span><span class="nf">input</span> <span class="ss">:email</span>
    <span class="o">=</span> <span class="n">f</span><span class="p">.</span><span class="nf">hidden_field</span> <span class="ss">:_destroy</span>
</code></pre></div>
<p>coffescript dosyamıza da aşağıdaki kodlarımızı koyuyoruz:</p>
<div class="highlight"><pre class="highlight javascript"><code><span class="nx">$</span><span class="p">(</span><span class="nb">document</span><span class="p">).</span><span class="nx">on</span> <span class="s1">'click'</span><span class="p">,</span> <span class="s1">'form .remove_fields'</span><span class="p">,</span> <span class="p">(</span><span class="nx">event</span><span class="p">)</span> <span class="o">-&gt;</span>
    <span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="nx">prev</span><span class="p">(</span><span class="s1">'input[type=hidden]'</span><span class="p">).</span><span class="nx">val</span><span class="p">(</span><span class="s1">'1'</span><span class="p">)</span>
    <span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="nx">closest</span><span class="p">(</span><span class="s1">'fieldset'</span><span class="p">).</span><span class="nx">remove</span><span class="p">()</span>
    <span class="nx">event</span><span class="p">.</span><span class="nx">preventDefault</span><span class="p">()</span>

<span class="nx">$</span><span class="p">(</span><span class="nb">document</span><span class="p">).</span><span class="nx">on</span> <span class="s1">'click'</span><span class="p">,</span> <span class="s1">'form .add_fields'</span><span class="p">,</span> <span class="p">(</span><span class="nx">event</span><span class="p">)</span> <span class="o">-&gt;</span>
    <span class="nx">time</span> <span class="o">=</span> <span class="k">new</span> <span class="nb">Date</span><span class="p">().</span><span class="nx">getTime</span><span class="p">()</span>
    <span class="nx">regexp</span> <span class="o">=</span> <span class="k">new</span> <span class="nb">RegExp</span><span class="p">(</span><span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="nx">data</span><span class="p">(</span><span class="s1">'id'</span><span class="p">),</span> <span class="s1">'g'</span><span class="p">)</span>
    <span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="nx">before</span><span class="p">(</span><span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="nx">data</span><span class="p">(</span><span class="s1">'fields'</span><span class="p">).</span><span class="nx">replace</span><span class="p">(</span><span class="nx">regexp</span><span class="p">,</span> <span class="nx">time</span><span class="p">))</span>
    <span class="nx">event</span><span class="p">.</span><span class="nx">preventDefault</span><span class="p">()</span>
</code></pre></div>
<p>Yukarıda yaptığımız işlemler ile aşağıdaki gibi bir çıktı elde edeceksiniz:</p>

<p><img alt="form" width="384" height="121" src="assets/images/articles/2017-02-10-rails-dynamic-nested-form.png" /></p>

<div id='disqus_thread'></div>
<script>
  var disqus_shortname = 'lab2023';
  (function() {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
</script>
<noscript>
Please enable JavaScript to view the
<a href='http://disqus.com/?ref_noscript'>comments powered by Disqus.</a>
</noscript>
<a class='dsq-brlink' href='http://disqus.com'>
comments powered by
<span class='logo-disqus'>Disqus</span>
</a>
</article>
</div>
</div>
</div>
<footer class='footer'>
<h4>© 2009 ~ 2020 LAB2023, CORP.</h4>
<p>The all designs, materials and contents trademarks of lab2023, corp.</p>
</footer>

</body>
<!-- Javascripts -->

<script src="//ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script><script src="//cdnjs.cloudflare.com/ajax/libs/modernizr/2.7.1/modernizr.min.js"></script><script src="assets/javascripts/vendor/swiper-bundle.min.js"></script><script src="assets/javascripts/application.js"></script>
<script>
  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-12243799-3']);
  _gaq.push(['_trackPageview']);
  
  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();
</script>


</html>
