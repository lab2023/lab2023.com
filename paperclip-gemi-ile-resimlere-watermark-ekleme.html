<!DOCTYPE html>
<html class='no-js' lang='en'>
<head>
<meta charset='utf-8'>
<meta content='IE=edge,chrome=1' http-equiv='X-UA-Compatible'>
<title>lab2023 | web & mobile development, graphic design company - Paperclip gemi ile resimlere watermark ekleme
</title>
<meta content='Designers and developers for hire' name='description'>
<meta content='design, ruby, ruby on rails, ios, android, sencha, istanbul, ankara, denizli, turkey' name='keywords'>
<link href="assets/stylesheets/application.css" rel="stylesheet" /><link href="//maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css" rel="stylesheet" /><link href="assets/stylesheets/swiper-bundle.min.css" rel="stylesheet" />
<link href="assets/images/favicon.png" rel="icon" type="image/png" />
<meta content='Paperclip gemi ile resimlere watermark ekleme' name='description'>
<meta content='paperclip, tr' name='keywords'>
<meta content='Hamit Türkü KAYA' name='author'>


</head>
<body id='blog'>
<header class='header'>
<div class='container'>
<div class='row'>
<div class='col-lg-2 col-lg-offset-1'>
<a href="/blog"><img class="logo pull-right" width="252" height="253" src="assets/images/logo.png" alt="Logo" />
</a></div>
<div class='col-lg-8'>
<h1>
<a href="/blog">lab2023's blog posts</a>
<a href="http://lab2023.com/feed.xml" target="_blank"><i class='fa fa-rss'></i>
</a></h1>
<div class='row'>
<div class='col-lg-3'>
<p>
<a href="/"><i class='fa fa-arrow-circle-left'></i>
lab2023.com
</a></p>
</div>
<div class='col-lg-9' id='language_linked'>
<p>
<a href="/tag/tr.html">Türkçe
</a>·
<a href="/tag/en.html">English
</a>·
<a href="/tag/es.html">Español
</a>·
<a href="/tag/ru.html">Русский
</a></p>
</div>
</div>
</div>
</div>
</div>
</header>

<!-- share-buttons js code -->
<div id='fb-root'>
<script>
  (function(d, s, id) {
    var js, fjs = d.getElementsByTagName(s)[0];
    if (d.getElementById(id)) return;
    js = d.createElement(s); js.id = id;
    js.src = "//connect.facebook.net/tr_TR/all.js#xfbml=1";
    fjs.parentNode.insertBefore(js, fjs);
  }(document, 'script', 'facebook-jssdk'));
  (function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs'));
</script>
</div>
<div class='container'>
<div class='row'>
<div class='col-lg-2 col-lg-offset-1 article-meta'>
<h4><a href="http://twitter.com/hamitturkukaya" target="_blank">Hamit Türkü KAYA</a></h4>
<h5>September 27, 2013</h5>
<span class='tag'><a href="/tag/paperclip.html">paperclip</a></span>
<span class='tag'><a href="/tag/tr.html"> tr</a></span>
<!-- Share buttons -->
<ul class='share_button'>
<li>
<div class='fb-share-button' data-href='http://lab2023.com/paperclip-gemi-ile-resimlere-watermark-ekleme.html' data-type='button_count'></div>
</li>
<li>
<a class='twitter-share-button' data-text='http://lab2023.com/paperclip-gemi-ile-resimlere-watermark-ekleme.html' data-via='lab2023' href='https://twitter.com/share'></a>
</li>
<li>
<script src='//platform.linkedin.com/in.js' type='text/javascript'>
<![CDATA[
    lang: en_US
]]>
</script>
<script data-url='http://lab2023.com/paperclip-gemi-ile-resimlere-watermark-ekleme.html' type='IN/Share'></script>
</li>
</ul>
</div>
<div class='col-lg-8'>
<article class='post'>
<h1>Paperclip gemi ile resimlere watermark ekleme</h1>
<p><a href="https://github.com/thoughtbot/paperclip">Paperclip</a> gemi varsayılan olarak resimlere watermark eklemeyi desteklemiyor. Bu yüzden watermark ekleyebilmek için projeye, imagemagick&#39;in resimleri birleştirme komutu olan &lsquo;composite&rsquo; i içeren bir processor eklememiz gerekiyor.</p>

<p>Öncelikle paperclip geminin processorları aradığı</p>
<div class="highlight"><pre class="highlight plaintext"><code>lib/paperclip_processors
</code></pre></div>
<p>klasörünün içine watermark.rb dosyamızı oluşturup</p>
<div class="highlight"><pre class="highlight ruby"><code><span class="k">module</span> <span class="nn">Paperclip</span>
  <span class="k">class</span> <span class="nc">Watermark</span> <span class="o">&lt;</span> <span class="no">Thumbnail</span>
    <span class="c1"># Handles watermarking of images that are uploaded.</span>
    <span class="nb">attr_accessor</span> <span class="ss">:format</span><span class="p">,</span> <span class="ss">:whiny</span><span class="p">,</span> <span class="ss">:watermark_path</span><span class="p">,</span> <span class="ss">:position</span>
    <span class="k">def</span> <span class="nf">initialize</span> <span class="n">file</span><span class="p">,</span> <span class="n">options</span> <span class="o">=</span> <span class="p">{},</span> <span class="n">attachment</span> <span class="o">=</span> <span class="kp">nil</span>
      <span class="k">super</span>
      <span class="vi">@file</span>             <span class="o">=</span> <span class="n">file</span>
      <span class="vi">@whiny</span>            <span class="o">=</span> <span class="n">options</span><span class="p">[</span><span class="ss">:whiny</span><span class="p">].</span><span class="nf">nil?</span> <span class="p">?</span> <span class="kp">true</span> <span class="p">:</span> <span class="n">options</span><span class="p">[</span><span class="ss">:whiny</span><span class="p">]</span>
      <span class="vi">@format</span>           <span class="o">=</span> <span class="n">options</span><span class="p">[</span><span class="ss">:format</span><span class="p">]</span>
      <span class="vi">@watermark_path</span>   <span class="o">=</span> <span class="n">options</span><span class="p">[</span><span class="ss">:watermark_path</span><span class="p">]</span>
      <span class="vi">@position</span>         <span class="o">=</span> <span class="n">options</span><span class="p">[</span><span class="ss">:watermark_position</span><span class="p">].</span><span class="nf">nil?</span> <span class="p">?</span> <span class="s2">"SouthEast"</span> <span class="p">:</span> <span class="n">options</span><span class="p">[</span><span class="ss">:watermark_position</span><span class="p">]</span>
      <span class="vi">@current_format</span>   <span class="o">=</span> <span class="no">File</span><span class="p">.</span><span class="nf">extname</span><span class="p">(</span><span class="vi">@file</span><span class="p">.</span><span class="nf">path</span><span class="p">)</span>
      <span class="vi">@basename</span>         <span class="o">=</span> <span class="no">File</span><span class="p">.</span><span class="nf">basename</span><span class="p">(</span><span class="vi">@file</span><span class="p">.</span><span class="nf">path</span><span class="p">,</span> <span class="vi">@current_format</span><span class="p">)</span>
    <span class="k">end</span>
    <span class="c1"># Performs the conversion of the +file+ into a watermark. Returns the Tempfile</span>
    <span class="c1"># that contains the new image.</span>
    <span class="k">def</span> <span class="nf">make</span>
      <span class="k">return</span> <span class="vi">@file</span> <span class="k">unless</span> <span class="n">watermark_path</span>
      <span class="n">dst</span> <span class="o">=</span> <span class="no">Tempfile</span><span class="p">.</span><span class="nf">new</span><span class="p">([</span><span class="vi">@basename</span><span class="p">,</span> <span class="vi">@format</span><span class="p">].</span><span class="nf">compact</span><span class="p">.</span><span class="nf">join</span><span class="p">(</span><span class="s2">"."</span><span class="p">))</span>
      <span class="n">dst</span><span class="p">.</span><span class="nf">binmode</span>
      <span class="n">command</span> <span class="o">=</span> <span class="s2">"composite"</span>
      <span class="n">params</span> <span class="o">=</span> <span class="s2">"-gravity </span><span class="si">#{</span><span class="vi">@position</span><span class="si">}</span><span class="s2"> </span><span class="si">#{</span><span class="n">watermark_path</span><span class="si">}</span><span class="s2"> </span><span class="si">#{</span><span class="n">fromfile</span><span class="si">}</span><span class="s2"> </span><span class="si">#{</span><span class="n">tofile</span><span class="p">(</span><span class="n">dst</span><span class="p">)</span><span class="si">}</span><span class="s2">"</span>
      <span class="k">begin</span>
        <span class="n">success</span> <span class="o">=</span> <span class="no">Paperclip</span><span class="p">.</span><span class="nf">run</span><span class="p">(</span><span class="n">command</span><span class="p">,</span> <span class="n">params</span><span class="p">)</span>
      <span class="k">rescue</span> <span class="no">PaperclipCommandLineError</span>
        <span class="k">raise</span> <span class="no">PaperclipError</span><span class="p">,</span> <span class="s2">"There was an error processing the watermark for </span><span class="si">#{</span><span class="vi">@basename</span><span class="si">}</span><span class="s2">"</span> <span class="k">if</span> <span class="vi">@whiny</span>
      <span class="k">end</span>
      <span class="n">dst</span>
    <span class="k">end</span>
    <span class="k">def</span> <span class="nf">fromfile</span>
      <span class="s2">"</span><span class="se">\"</span><span class="si">#{</span> <span class="no">File</span><span class="p">.</span><span class="nf">expand_path</span><span class="p">(</span><span class="vi">@file</span><span class="p">.</span><span class="nf">path</span><span class="p">)</span> <span class="si">}</span><span class="s2">[0]</span><span class="se">\"</span><span class="s2">"</span>
    <span class="k">end</span>
    <span class="k">def</span> <span class="nf">tofile</span><span class="p">(</span><span class="n">destination</span><span class="p">)</span>
      <span class="s2">"</span><span class="se">\"</span><span class="si">#{</span> <span class="no">File</span><span class="p">.</span><span class="nf">expand_path</span><span class="p">(</span><span class="n">destination</span><span class="p">.</span><span class="nf">path</span><span class="p">)</span> <span class="si">}</span><span class="s2">[0]</span><span class="se">\"</span><span class="s2">"</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div>
<p>şeklinde watermark classımızı ekliyoruz.</p>

<p>Ardından ilgili model dosyamızda</p>
<div class="highlight"><pre class="highlight ruby"><code><span class="n">has_attached_file</span> <span class="ss">:photo</span><span class="p">,</span>
<span class="ss">processors: </span><span class="p">[</span><span class="ss">:thumbnail</span><span class="p">,</span> <span class="ss">:watermark</span><span class="p">],</span>
<span class="ss">styles: </span><span class="p">{</span>
  <span class="ss">zoom: </span><span class="p">{</span> <span class="ss">geometry: </span><span class="s1">'1024x576#'</span><span class="p">,</span> <span class="ss">watermark_path: </span><span class="s2">"</span><span class="si">#{</span><span class="no">Rails</span><span class="p">.</span><span class="nf">root</span><span class="si">}</span><span class="s2">/app/assets/images/watermarks/watermark_zoom.png"</span><span class="p">},</span>
  <span class="ss">main: </span><span class="p">{</span> <span class="ss">geometry: </span><span class="s1">'770x520#'</span><span class="p">,</span> <span class="ss">watermark_path: </span><span class="s2">"</span><span class="si">#{</span><span class="no">Rails</span><span class="p">.</span><span class="nf">root</span><span class="si">}</span><span class="s2">/app/assets/images/watermarks/watermark_main.png"</span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p>şeklinde eklediğimiz resimler için kullanılacak processorlerı tanımlıyoruz, thumbnail resimlerin boyutunu düzenlemek için paperclipte tanımlanmış processor classıdır eklenmediği sürece resim boyutlandırması yapılmaz. Ardından farklı boyutlar için yeniden boyutlandırma için geometry ve watermark olarak eklenecek resmimizin path&#39;ini veriyoruz.</p>

<p>Bu işlemlerden sonra eklenecek her resime watermark&#39;ınız eklenecektir.</p>

<p>Eğer daha önce upload ettiğiniz resimlere de watermark&#39;ınızın eklenmesini istiyorsanız.</p>
<div class="highlight"><pre class="highlight plaintext"><code>rake paperclip:refresh class=Product
</code></pre></div>
<p>rake&#39;ini çalıştırmanız yeterlidir.</p>

<div id='disqus_thread'></div>
<script>
  var disqus_shortname = 'lab2023';
  (function() {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
</script>
<noscript>
Please enable JavaScript to view the
<a href='http://disqus.com/?ref_noscript'>comments powered by Disqus.</a>
</noscript>
<a class='dsq-brlink' href='http://disqus.com'>
comments powered by
<span class='logo-disqus'>Disqus</span>
</a>
</article>
</div>
</div>
</div>
<footer class='footer'>
<h4>© 2009 ~ 2023 LAB2023, CORP.</h4>
<p>The all designs, materials and contents trademarks of lab2023, corp.</p>
</footer>

</body>
<!-- Javascripts -->

<script src="//ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script><script src="//cdnjs.cloudflare.com/ajax/libs/modernizr/2.7.1/modernizr.min.js"></script><script src="assets/javascripts/vendor/swiper-bundle.min.js"></script><script src="assets/javascripts/application.js"></script>
<script>
  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-12243799-3']);
  _gaq.push(['_trackPageview']);
  
  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();
</script>


</html>
