<!DOCTYPE html>
<html class='no-js' lang='en'>
<head>
<meta charset='utf-8'>
<meta content='IE=edge,chrome=1' http-equiv='X-UA-Compatible'>
<title>lab2023 | web & mobile development, graphic design company - Rails' de Elasticsearch Kullanımı
</title>
<meta content='Designers and developers for hire' name='description'>
<meta content='design, ruby, ruby on rails, ios, android, sencha, istanbul, ankara, denizli, turkey' name='keywords'>
<link href="assets/stylesheets/application.css" rel="stylesheet" /><link href="//maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css" rel="stylesheet" /><link href="assets/stylesheets/swiper-bundle.min.css" rel="stylesheet" />
<link href="assets/images/favicon.png" rel="icon" type="image/png" />
<meta content='Rails&#39; de Elasticsearch Kullanımı' name='description'>
<meta content='rails, elasticsearch, arama, full, text, tr' name='keywords'>
<meta content='Ahmet Sezgin DURAN' name='author'>


</head>
<body id='blog'>
<header class='header'>
<div class='container'>
<div class='row'>
<div class='col-lg-2 col-lg-offset-1'>
<a href="/blog"><img class="logo pull-right" width="252" height="253" src="assets/images/logo.png" alt="Logo" />
</a></div>
<div class='col-lg-8'>
<h1>
<a href="/blog">lab2023's blog posts</a>
<a href="http://lab2023.com/feed.xml" target="_blank"><i class='fa fa-rss'></i>
</a></h1>
<div class='row'>
<div class='col-lg-3'>
<p>
<a href="/"><i class='fa fa-arrow-circle-left'></i>
lab2023.com
</a></p>
</div>
<div class='col-lg-9' id='language_linked'>
<p>
<a href="/tag/tr.html">Türkçe
</a>·
<a href="/tag/en.html">English
</a>·
<a href="/tag/es.html">Español
</a>·
<a href="/tag/ru.html">Русский
</a></p>
</div>
</div>
</div>
</div>
</div>
</header>

<!-- share-buttons js code -->
<div id='fb-root'>
<script>
  (function(d, s, id) {
    var js, fjs = d.getElementsByTagName(s)[0];
    if (d.getElementById(id)) return;
    js = d.createElement(s); js.id = id;
    js.src = "//connect.facebook.net/tr_TR/all.js#xfbml=1";
    fjs.parentNode.insertBefore(js, fjs);
  }(document, 'script', 'facebook-jssdk'));
  (function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs'));
</script>
</div>
<div class='container'>
<div class='row'>
<div class='col-lg-2 col-lg-offset-1 article-meta'>
<h4><a href="http://twitter.com/marjinal1st" target="_blank">Ahmet Sezgin DURAN</a></h4>
<h5>June 13, 2014</h5>
<span class='tag'><a href="/tag/rails.html">rails</a></span>
<span class='tag'><a href="/tag/elasticsearch.html"> elasticsearch</a></span>
<span class='tag'><a href="/tag/arama.html"> arama</a></span>
<span class='tag'><a href="/tag/full.html"> full</a></span>
<span class='tag'><a href="/tag/text.html"> text</a></span>
<span class='tag'><a href="/tag/tr.html"> tr</a></span>
<!-- Share buttons -->
<ul class='share_button'>
<li>
<div class='fb-share-button' data-href='http://lab2023.com/railsde-elasticsearch-kullanimi.html' data-type='button_count'></div>
</li>
<li>
<a class='twitter-share-button' data-text='http://lab2023.com/railsde-elasticsearch-kullanimi.html' data-via='lab2023' href='https://twitter.com/share'></a>
</li>
<li>
<script src='//platform.linkedin.com/in.js' type='text/javascript'>
<![CDATA[
    lang: en_US
]]>
</script>
<script data-url='http://lab2023.com/railsde-elasticsearch-kullanimi.html' type='IN/Share'></script>
</li>
</ul>
</div>
<div class='col-lg-8'>
<article class='post'>
<h1>Rails' de Elasticsearch Kullanımı</h1>
<p>Rails web uygulamalarında içerik araması temel olarak oldukça kolay olsa da, tam metin araması (full text search) gerektiği zaman uygun bir çözüm bulmak zor oluyor. Bu yazıda, <strong>full text search</strong> konusunda en bilindik ve başarılı çözümlerden birisi olan <a href="http://www.elasticsearch.org/">Elasticsearch</a> yazılımını, Rails uygulamanıza nasıl entegre edebileceğinizi anlatacağım.</p>

<p>Başlamadan önce şöyle bir açıklama yapmak lazım ki, Elasticsearch bir gem değil, apayrı bir yazılım. Hatta buna arama motoru demek çok da yanlış olmaz. Öncelikle Elasticsearch yazılımını ayrı bir şekilde kuracağız ve onunla etkileşime geçmesi için de bir bağdaştırıcı (adapter) gemi kullanacağız.</p>

<p>Başlamak için Elasticsearch yazılımını kuralım. İsteğe bağlı olarak GNU/Linux dağıtımınızın deposundan (bir çok popüler dağıtımda mevcut) aratıp kurabilirsiniz. Bunun dışında Mac OS X kullanıyorsanız aşağıdaki komutlar ile hızlıca kurup, kullanmaya başlayabilirsiniz:</p>
<div class="highlight"><pre class="highlight shell"><code><span class="nv">$ </span>brew <span class="nb">install </span>elasticsearch
<span class="nv">$ </span>elasticsearch <span class="nt">-D</span> es.config<span class="o">=</span>/usr/local/opt/elasticsearch/config/elasticsearch.yml
</code></pre></div>
<p>Ancak ben bu yazıda, daha genel ve esnek olmasından dolayı indirip elle çalıştırma yöntemini kullanacağım. Aşağıdaki siteye girelim ve arşivlenmiş bir sürümünü indirerek başlayalım:</p>

<p><a href="http://www.elasticsearch.org/overview/elkdownloads/">http://www.elasticsearch.org/overview/elkdownloads/</a></p>

<p>ZIP veya TAR olarak indirdiğiniz paketi açın ve terminalinizden, açılan paketin klasörüne girin. Ardından çalıştırmak için şu komutu verin: (<strong>Önemli:</strong> Elasticsearch&#39;ü çalıştırmak için sisteminizde <a href="http://www.oracle.com/technetwork/java/javase/downloads/index.html?ssSourceSiteId=otnjp">JDK</a>&rsquo;nın en az 6.0 sürümü <a href="http://www.elasticsearch.org/guide/en/elasticsearch/hadoop/current/requirements.html#requirements-jdk">bulunmalı</a>.)</p>
<div class="highlight"><pre class="highlight shell"><code><span class="nv">$ </span>./bin/elasticsearch
</code></pre></div>
<p>Sistemin çalışıp çalışmadığını test etmek için, ufak bir HTTP isteği yapalım. Başka bir terminal oturumundan şu komutu verin:</p>
<div class="highlight"><pre class="highlight shell"><code><span class="nv">$ </span>curl <span class="nt">-X</span> GET http://localhost:9200/
</code></pre></div>
<p>Eğer hiçbir sıkıntı yoksa, şuna benzeyen bir JSON verisi cevap olarak dönecek:</p>
<div class="highlight"><pre class="highlight json"><code><span class="p">{</span><span class="w">
  </span><span class="nl">"status"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">200</span><span class="p">,</span><span class="w">
  </span><span class="nl">"name"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"Emplate"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"version"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nl">"number"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"1.2.0"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"build_hash"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"c82387f290c21505f781c695f365d0ef4098b272"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"build_timestamp"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"2014-05-22T12:49:13Z"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"build_snapshot"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w">
    </span><span class="nl">"lucene_version"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"4.8"</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="nl">"tagline"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"You Know, for Search"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div>
<p>Şimdi sıra geldi uygulamayı Rails ile bütünleştirmeye. Bunun için <strong>elasticsearch-model</strong> ve <strong>elasticsearch-rails</strong> <a href="https://github.com/elasticsearch/elasticsearch-rails">gemlerini</a> kullanacağız. Biraz bahsetmek gerekirse: <strong>elasticsearch-model</strong> gemi, Elasticsearch arama motoru ile etkileşime geçen bağdaştırıcı (adapter) kütüphanedir. Bunun dışında diğer gem olan <strong>elasticsearch-rails</strong> ise Rails&#39;de kullanımı kolaylaştırmak için ekstra araçlara (Rake görevleri vs.) sahiptir.</p>

<p>Kullanmaya başlamak için uygulamanızın <strong>Gemfile</strong> dosyasına şu iki satırı ekleyin:</p>
<div class="highlight"><pre class="highlight ruby"><code><span class="n">gem</span> <span class="s1">'elasticsearch-model'</span>
<span class="n">gem</span> <span class="s1">'elasticsearch-rails'</span>
</code></pre></div>
<p>Ardından gemleri yükleyin:</p>
<div class="highlight"><pre class="highlight shell"><code><span class="nv">$ </span>bundle <span class="nb">install</span>
</code></pre></div>
<p>Bundan sonrasında yapmanız gereken tek şey, ihtiyaç duyduğunuz modellere şu satırları eklemek. Örnek bir model ile gösteriyorum:</p>
<div class="highlight"><pre class="highlight ruby"><code><span class="k">class</span> <span class="nc">Product</span> <span class="o">&lt;</span> <span class="no">ActiveRecord</span><span class="o">::</span><span class="no">Base</span>
  <span class="kp">include</span> <span class="no">Elasticsearch</span><span class="o">::</span><span class="no">Model</span>
  <span class="kp">include</span> <span class="no">Elasticsearch</span><span class="o">::</span><span class="no">Model</span><span class="o">::</span><span class="no">Callbacks</span>
<span class="k">end</span>
</code></pre></div>
<p>Ve kullanmaya başlayabiliriz. Test etmek için Rails konsoluna girelim:</p>
<div class="highlight"><pre class="highlight shell"><code><span class="nv">$ </span>rails c
</code></pre></div><div class="highlight"><pre class="highlight ruby"><code><span class="vi">@products</span> <span class="o">=</span> <span class="no">Product</span><span class="p">.</span><span class="nf">search</span><span class="p">(</span><span class="s1">'foo bar'</span><span class="p">).</span><span class="nf">records</span>
</code></pre></div>
<p>Bu şekilde modeller üstünden full text search araması yapılabilmekte. <strong>search</strong> metotundan sonra kullandığımız <strong>records</strong> metotu da, bunu normal bir ActiveRecord sorgu sonucu olarak kullanabilmemizi sağlıyor. Bu sayede, bunu kontrolcüde de kullanıp, verileri sıkıntısız bir şekilde görünüm (view) katmanına taşıyarak kullanabilirsiniz.</p>

<p>Ekstra olarak, eğer <strong>elasticsearch-rails</strong> geminden gelen Rake görevlerini (task) kullanmak isterseniz, uygulamanızın Rakefile dosyasının başına şunu ekleyin:</p>
<div class="highlight"><pre class="highlight ruby"><code><span class="nb">require</span> <span class="s1">'elasticsearch/rails/tasks/import'</span>
</code></pre></div>
<p>Ardından eski kayıtların Elasticsearch tarafından import edilmesi için de şu komutu verin:</p>
<div class="highlight"><pre class="highlight shell"><code>bundle <span class="nb">exec </span>rake environment elasticsearch:import:all
</code></pre></div>
<p>Aynı işi, Rails konsolundan şu şekilde de yapmanız mümkün:</p>
<div class="highlight"><pre class="highlight ruby"><code><span class="no">Product</span><span class="p">.</span><span class="nf">import</span>
</code></pre></div>
<div id='disqus_thread'></div>
<script>
  var disqus_shortname = 'lab2023';
  (function() {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
</script>
<noscript>
Please enable JavaScript to view the
<a href='http://disqus.com/?ref_noscript'>comments powered by Disqus.</a>
</noscript>
<a class='dsq-brlink' href='http://disqus.com'>
comments powered by
<span class='logo-disqus'>Disqus</span>
</a>
</article>
</div>
</div>
</div>
<footer class='footer'>
<h4>© 2009 ~ 2023 LAB2023, CORP.</h4>
<p>The all designs, materials and contents trademarks of lab2023, corp.</p>
</footer>

</body>
<!-- Javascripts -->

<script src="//ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script><script src="//cdnjs.cloudflare.com/ajax/libs/modernizr/2.7.1/modernizr.min.js"></script><script src="assets/javascripts/vendor/swiper-bundle.min.js"></script><script src="assets/javascripts/application.js"></script>
<script>
  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-12243799-3']);
  _gaq.push(['_trackPageview']);
  
  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();
</script>


</html>
