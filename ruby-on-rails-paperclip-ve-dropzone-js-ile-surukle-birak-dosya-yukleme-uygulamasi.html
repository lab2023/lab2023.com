<!DOCTYPE html>
<html class='no-js' lang='en'>
<head>
<meta charset='utf-8'>
<!-- Always force latest IE rendering engine or request Chrome Frame -->
<meta content='IE=edge,chrome=1' http-equiv='X-UA-Compatible'>
<title></title>
<link href="assets/stylesheets/application.css" media="screen" rel="stylesheet" type="text/css" />
<link href="//netdna.bootstrapcdn.com/font-awesome/4.0.3/css/font-awesome.css" media="screen" rel="stylesheet" type="text/css" />
<link href="assets/images/favicon.png" rel="icon" type="image/png" />

</head>
<body id='blog'>
BLOG LAYOUT
<div class='container'>
<div class='row'>
<div class='col-lg-2'>
<h5>July  6, 2013</h5>
<ul></ul>
<li><a href="/tag/paperclip.html">paperclip</a></li>
<li><a href="/tag/dropzone.html">dropzone</a></li>
</div>
<div class='col-lg-10'>
<article>
<h1>Ruby on Rails, Paperclip ve Dropzone.js ile sürükle bırak dosya yükleme uygulaması</h1>
<p><strong>Dropzone.js</strong></p>

<p>Daha önceki projelerde jquery-fileupload-rails gemini kullanmıştım ama onlarca satır haml ve erb kodu yazmak pek içime sinmemişti bu işin daha basit bir yöntemi olmalı demiştim bu arayışıta dropzone ile karşılaştım basitliği ve eski tarayıcılara destek vermemesi beni cezbetti (like a jquery 2)</p>

<!--more-->

<p><strong>Diğerlerinden Farkı</strong></p>

<ul>
<li>  Küçük boyut</li>
<li>  Framework bağımsız</li>
<li>  Güncel Tarayıcı API&#39;leri</li>
<li>  Sade Tasarım</li>
<li>  Resimlerde Küçültülmüş önizleme</li>
</ul>

<h1><strong>Kurulum</strong></h1>

<p>Rails projemizi oluşturalım</p>

<p><code>rails new rails-paperclip-dropzone-example</code></p>

<h2>Gemler</h2>

<p>Rails projemize ilk olarak dropzonejs-rails ve paperclip gemlerini dahil ediyoruz.</p>
<pre class="highlight plaintext">gem 'dropzonejs-rails'
gem 'paperclip'
</pre>

<h2>Assets</h2>

<p>application.css.sass</p>
<pre class="highlight plaintext">@import 'dropzone/dropzone'
</pre>

<p>application.js.coffee</p>
<pre class="highlight plaintext">#= require dropzone
</pre>

<h2>Scaffold</h2>

<p>Gerekli model ve controllerları scaffold yardımıyla oluşturalım.</p>

<p><code>rails g scaffold product name:string</code></p>

<p><code>rails g scaffold photo photo:attachment product:references</code></p>

<p>prodcut.rb model dosyasına aşağıdaki ilişkiyi tanımlıyoruz.</p>
<pre class="highlight plaintext">has_many :photos
</pre>

<h1><strong>Kullanımı</strong></h1>

<p>application.js.coffee</p>
<pre class="highlight plaintext">Dropzone.options.photoDropzone =
  paramName: "photo"
  maxFilesize: 2 #mb
  addRemoveLinks: true
  init: -&gt;
    @on 'removedfile', (file) -&gt;
      if file.xhr
        $.ajax
          url: "#{$("#photo-dropzone").attr "action"}/#{JSON.parse(file.xhr.response).id}"
          type: 'DELETE'
</pre>

<p>Sürükle bırak formu için aşağıdaki kodu formun çıkmasını istediğimiz haml dosyasına yazıyoruz.</p>
<pre class="highlight plaintext">= form_for [@product, Photo.new], multipart: true, html: {class: :dropzone, id: 'photo-dropzone'} do |f|
  = f.hidden_field :photo
  = f.hidden_field :product_id, value: @product.id
</pre>

<p>Controller içinde sadece create methodunun bulunması yeterli tabi dropzone içersinde silmek için buton çıkarabileceğiniz bir ayar mevcut bununla birlikte silme gibi işlemleri halledebileceğinizi düşünüyorum.</p>
<pre class="highlight plaintext">def create
  @photo = Photo.create(photo: params[:photo], product_id: params[:photo][:product_id])
  render json: @photo
end

def destroy
  @photo = Photo.find(params[:id])
  @photo.destroy
  render nothing: true
end
</pre>

<p>Toplamda 10 satırda projelerinize sürükle bırak dosya yükleme formu yapabilirsiniz. <img alt="dropzonejs" width="881" height="550" src="assets/images/articles/2013-07-06-dropzone.png" /></p>

<p>5 ay sonra gelen güncelleme:</p>

<p>Silme işlemi eklendi. Kodumuz silme işleminide ekleyince 10 satırı geçti kusura bakmayın artık. :D ileride demo uygulama yapabilirim validasyon mesajlarını gösteren serverda thumnail oluşunca güncellemeli falan..</p>

<div id='disquss_thread'></div>
<script>
  /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
  var disqus_shortname = 'lab2023'; // required: replace example with your forum shortname
  
  /* * * DON'T EDIT BELOW THIS LINE * * */
  (function() {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
</script>
<noscript>
Please enable JavaScript to view the
<a href='http://disqus.com/?ref_noscript'>comments powered by Disqus.</a>
</noscript>
<a class='dsq-brlink' href='http://disqus.com'>
comments powered by
<span class='logo-disqus'>Disqus</span>
</a>
</article>
</div>
</div>
</div>
<footer class='footer'>
<h4>© 2014 LAB2023, CORP.</h4>
<p>The all designs, materials and contents trademarks of lab2023, corp.</p>
</footer>
<script>
  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-12243799-3']);
  _gaq.push(['_trackPageview']);
  
  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();
</script>

</body>
<!-- Javascripts -->

<script src="//ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js" type="text/javascript"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/modernizr/2.7.1/modernizr.min.js" type="text/javascript"></script>
<script src="assets/javascripts/application.js" type="text/javascript"></script>
</html>
